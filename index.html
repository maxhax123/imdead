<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI-Powered TNTL Site</title>
<style>
  /* Background */
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #111;
    text-align: center;
    padding: 20px;
    margin: 0;
  }

  /* Container max width */
  #image-container img {
    max-width: 90vw;
    max-height: 300px;
    border-radius: 10px;
    box-shadow: 0 0 15px #555;
    margin: 0 auto;
    display: block;
  }

  #sound-player {
    margin: 20px 0;
  }

  /* White button theme */
  button.vote-btn, #dose-btn, #close-summary {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    background: white;
    color: black;
    border: 2px solid #555;
    padding: 12px 20px;
    margin: 10px 6px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.15s ease, color 0.15s ease, transform 0.15s ease;
    user-select: none;
    font-size: 1.2rem;
    min-width: 120px;
  }
  button.vote-btn:hover, #dose-btn:hover, #close-summary:hover {
    background: #ddd;
    transform: scale(1.05);
  }

  #round-counter {
    margin: 20px 0;
    font-weight: bold;
    font-size: 1.4rem;
    color: #222;
    text-shadow: 1px 1px 2px #fff;
  }

  #risk-label {
    color: #cc0000;
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1.3rem;
    text-shadow: 1px 1px 3px #fff;
  }

  /* Modal */
  #summary-modal {
    display: none;
    position: fixed;
    top: 5vh;
    left: 10vw;
    width: 80vw;
    height: 90vh;
    overflow-y: auto;
    background: rgba(255,255,255,0.95);
    border: 2px solid #555;
    border-radius: 10px;
    padding: 20px;
    color: #111;
    z-index: 1000;
    box-shadow: 0 0 15px #999;
  }
  #summary-modal h2 {
    margin-top: 0;
  }
  #summary-modal table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
  }
  #summary-modal th, #summary-modal td {
    padding: 8px 12px;
    border-bottom: 1px solid #aaa;
  }

  /* Responsive for mobile */
  @media (max-width: 600px) {
    button.vote-btn, #dose-btn, #close-summary {
      font-size: 1rem;
      min-width: 90px;
      padding: 10px 16px;
      margin: 8px 4px;
    }
    #image-container img {
      max-height: 200px;
    }
    #round-counter, #risk-label {
      font-size: 1.1rem;
    }
  }
</style>
</head>
<body>

<h1>Try Not To Laugh ‚Äî AI-Powered TNTL</h1>
<div id="round-counter">Round: 1</div>
<div id="risk-label" style="display:none;">‚ö†Ô∏è RISK ROUND ‚ö†Ô∏è</div>

<div id="image-container">
  <img id="meme-image" src="" alt="Meme Image" />
</div>

<div id="sound-player">
  <audio id="meme-sound" controls></audio>
</div>

<div id="buttons-container">
  <button class="vote-btn" data-vote="DEAD">üíÄ I'M DEAD</button>
  <button class="vote-btn" data-vote="FUNNY">üòÇ Funny</button>
  <button class="vote-btn" data-vote="MEH">üòê Meh</button>
  <button class="vote-btn" data-vote="TRASH">üóëÔ∏è Trash</button>
  <button class="vote-btn" data-vote="KYS">ü§¨ KYS</button>
</div>

<button id="dose-btn">I've had my daily dose</button>

<!-- Summary Modal -->
<div id="summary-modal">
  <h2>Your TNTL Content Weights</h2>
  <h3>Images</h3>
  <table id="images-summary">
    <thead><tr><th>ID</th><th>Weight (0-10)</th></tr></thead>
    <tbody></tbody>
  </table>
  <h3>Sounds</h3>
  <table id="sounds-summary">
    <thead><tr><th>ID</th><th>Weight (0-10)</th></tr></thead>
    <tbody></tbody>
  </table>
  <button id="close-summary">Close</button>
</div>

<script>
// === CONTENT PLACEHOLDERS ===
const images = [
  {id:1, src:'images/1.gif', weight:5},
  {id:2, src:'images/2.gif', weight:5},
  {id:3, src:'images/3.gif', weight:5},
  {id:4, src:'images/4.gif', weight:5},
  {id:5, src:'images/5.gif', weight:5},
  {id:6, src:'images/6.gif', weight:5},
  {id:7, src:'images/7.gif', weight:5},
  {id:8, src:'images/8.gif', weight:5},
  {id:9, src:'images/9.gif', weight:5},
  {id:10, src:'images/10.gif', weight:5},
  {id:11, src:'images/11.gif', weight:5},
  {id:12, src:'images/12.gif', weight:5},
  {id:13, src:'images/13.gif', weight:5},
  {id:14, src:'images/14.gif', weight:5},
  {id:15, src:'images/15.gif', weight:5},
  {id:16, src:'images/16.gif', weight:5},
  {id:17, src:'images/17.gif', weight:5},
  {id:18, src:'images/18.gif', weight:5},
  {id:19, src:'images/19.gif', weight:5},
  {id:20, src:'images/20.gif', weight:5}
];

const sounds = [
  {id:1, src:'sounds/1.mp3', weight:5},
  {id:2, src:'sounds/2.mp3', weight:5},
  {id:3, src:'sounds/3.mp3', weight:5},
  {id:4, src:'sounds/4.mp3', weight:5},
  {id:5, src:'sounds/5.mp3', weight:5},
  {id:6, src:'sounds/6.mp3', weight:5},
  {id:7, src:'sounds/7.mp3', weight:5},
  {id:8, src:'sounds/8.mp3', weight:5},
  {id:9, src:'sounds/9.mp3', weight:5},
  {id:10, src:'sounds/10.mp3', weight:5},
  {id:11, src:'sounds/11.mp3', weight:5},
  {id:12, src:'sounds/12.mp3', weight:5},
  {id:13, src:'sounds/13.mp3', weight:5},
  {id:14, src:'sounds/14.mp3', weight:5},
  {id:15, src:'sounds/15.mp3', weight:5},
  {id:16, src:'sounds/16.mp3', weight:5},
  {id:17, src:'sounds/17.mp3', weight:5},
  {id:18, src:'sounds/18.mp3', weight:5},
  {id:19, src:'sounds/19.mp3', weight:5},
  {id:20, src:'sounds/20.mp3', weight:5}
];

// === UTILS ===
function weightedRandom(arr) {
  const totalWeight = arr.reduce((acc, item) => acc + item.weight, 0);
  let rand = Math.random() * totalWeight;
  for (const item of arr) {
    if (rand < item.weight) return item;
    rand -= item.weight;
  }
  return arr[arr.length-1];
}

function lowestN(arr, n) {
  return [...arr].sort((a,b) => a.weight - b.weight).slice(0,n);
}

// === STATE ===
let round = 1;
let currentImage = null;
let currentSound = null;
const LEARNING_RATE = 1;
const REPEAT_PENALTY = 3;
let lastImage = null;
let lastSound = null;

// === UI ELEMENTS ===
const roundCounter = document.getElementById('round-counter');
const riskLabel = document.getElementById('risk-label');
const memeImage = document.getElementById('meme-image');
const memeSound = document.getElementById('meme-sound');
const buttons = document.querySelectorAll('button.vote-btn');
const doseBtn = document.getElementById('dose-btn');
const summaryModal = document.getElementById('summary-modal');
const imagesSummaryTbody = document.querySelector('#images-summary tbody');
const soundsSummaryTbody = document.querySelector('#sounds-summary tbody');
const closeSummaryBtn = document.getElementById('close-summary');

// === PICK CONTENT WITH REPEAT PUNISHMENT ===
function nextRound() {
  roundCounter.textContent = `Round: ${round}`;
  const isRiskRound = (round % 5 === 0);
  riskLabel.style.display = isRiskRound ? 'block' : 'none';

  function getEffectiveWeights(arr, lastItem) {
    return arr.map(item => {
      if (lastItem && item.id === lastItem.id) {
        return {...item, weight: Math.max(item.weight - REPEAT_PENALTY, 0)};
      }
      return {...item};
    });
  }

  let imageCandidates = isRiskRound ? lowestN(images, 5) : images;
  let soundCandidates = isRiskRound ? lowestN(sounds, 5) : sounds;

  const weightedImages = getEffectiveWeights(imageCandidates, lastImage);
  const weightedSounds = getEffectiveWeights(soundCandidates, lastSound);

  currentImage = weightedRandom(weightedImages);
  currentSound = weightedRandom(weightedSounds);

  memeImage.src = currentImage.src;
  memeImage.alt = `Meme Image #${currentImage.id}`;

  memeSound.src = currentSound.src;
  memeSound.load();
  memeSound.play().catch(() => {});

  lastImage = currentImage;
  lastSound = currentSound;
}

// === VOTE HANDLER ===
function vote(voteType) {
  const clamp = (num, min, max) => Math.min(Math.max(num, min), max);
  function updateWeight(item) {
    switch(voteType) {
      case 'DEAD': item.weight = clamp(item.weight + 3 * LEARNING_RATE, 0, 10); break;
      case 'FUNNY': item.weight = clamp(item.weight + 1 * LEARNING_RATE, 0, 10); break;
      case 'MEH': /* no change */ break;
      case 'TRASH': item.weight = clamp(item.weight - 2 * LEARNING_RATE, 0, 10); break;
      case 'KYS': item.weight = clamp(item.weight - 4 * LEARNING_RATE, 0, 10); break;
    }
  }

  updateWeight(currentImage);
  updateWeight(currentSound);

  round++;
  nextRound();
}

// === SHOW SUMMARY ===
function showSummary() {
  imagesSummaryTbody.innerHTML = '';
  soundsSummaryTbody.innerHTML = '';

  images.forEach(img => {
    const tr = document.createElement('tr');
    const tdId = document.createElement('td');
    tdId.textContent = img.id;
    const tdWeight = document.createElement('td');
    tdWeight.textContent = img.weight.toFixed(2);
    tr.appendChild(tdId);
    tr.appendChild(tdWeight);
    imagesSummaryTbody.appendChild(tr);
  });

  sounds.forEach(snd => {
    const tr = document.createElement('tr');
    const tdId = document.createElement('td');
    tdId.textContent = snd.id;
    const tdWeight = document.createElement('td');
    tdWeight.textContent = snd.weight.toFixed(2);
    tr.appendChild(tdId);
    tr.appendChild(tdWeight);
    soundsSummaryTbody.appendChild(tr);
  });

  summaryModal.style.display = 'block';
}

// === CLOSE SUMMARY ===
closeSummaryBtn.onclick = () => {
  summaryModal.style.display = 'none';
};

doseBtn.onclick = showSummary;

// === INIT ===
function init() {
  nextRound();

  buttons.forEach(btn => {
    btn.addEventListener('click', () => vote(btn.dataset.vote));
  });
}

init();
</script>
</body>
</html>
